cmake_minimum_required(VERSION 3.18 FATAL_ERROR)
project(aoti_example LANGUAGES CXX CUDA)

find_package(Torch REQUIRED)
# find_package(Python3 COMPONENTS Development REQUIRED)

# include_directories(${CMAKE_CURRENT_SOURCE_DIR}/../src)
# include_directories(${Python3_INCLUDE_DIRS})


# set(CMAKE_C_FLAGS    "${CMAKE_C_FLAGS} -O3 -fdiagnostics-color=always -w")
# set(CMAKE_CXX_FLAGS  "${CMAKE_CXX_FLAGS} -O3 -fdiagnostics-color=always -w")
# #TODO: the warning should not be suppressed in the  long term
# set(CMAKE_CUDA_FLAGS "${CMAKE_CUDA_FLAGS} -O3 --expt-relaxed-constexpr --expt-extended-lambda --use_fast_math -gencode arch=compute_70,code=sm_70 -gencode arch=compute_75,code=sm_75 -gencode arch=compute_80,code=sm_80 -gencode arch=compute_90,code=sm_90 -w -U__CUDA_NO_HALF_OPERATORS__ -U__CUDA_NO_HALF_CONVERSIONS__ -U__CUDA_NO_HALF2_OPERATORS__ -U__CUDA_NO_BFLOAT16_CONVERSIONS__ -UCUDA_ERROR_CHECK")

# file(GLOB TABLE_OP_SOURCES "${CMAKE_CURRENT_SOURCE_DIR}/../src/table_operation/*.cu")
add_executable(aoti_example 
    inference.cpp 
    # torch_bind.cpp
    # ${TABLE_OP_SOURCES}
    # ../src/utils.cpp
)

# Assumes model.pt2 is generated by running example.py --export
# add_custom_command(
#     OUTPUT model.pt2
#     COMMAND python ${CMAKE_CURRENT_SOURCE_DIR}/model.py
#     DEPENDS model.py
# )

target_link_libraries(aoti_example "${TORCH_LIBRARIES}" )
set_property(TARGET aoti_example PROPERTY CXX_STANDARD 17)
set_property(TARGET aoti_example PROPERTY CUDA_STANDARD 17)
